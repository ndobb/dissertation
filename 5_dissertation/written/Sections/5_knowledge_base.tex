\documentclass[../main.tex]{subfiles}

\begin{document}

\definecolor{dkgreen}{rgb}{0,0.6,0}
\definecolor{gray}{rgb}{0.5,0.5,0.5}
\definecolor{mauve}{rgb}{0.58,0,0.82}

\lstset{frame=tb,
  language=SPARQL,
  aboveskip=1mm,
  belowskip=1mm,
  showstringspaces=true,
  columns=flexible,
  basicstyle={\footnotesize\ttfamily},
  numbers=none,
  numberstyle=\tiny\color{gray},
  keywordstyle=\color{blue},
  commentstyle=\color{dkgreen},
  stringstyle=\color{mauve},
  breaklines=false,
  breakatwhitespace=false,
  tabsize=3
}

\section{Overview}

Storing biomedical information such as conceptual mappings, controlled vocabularies and terminologies, synonyms, hyponyms, and hypernyms enables a great variety of useful capabilities for a natural language interface for cohort discovery. For example, enabling users to simply specify "Patients without contraindications to Metformin"\textemdash without needing to exhaustively list what such contraindications may be\textemdash saves user time and energy, and also possibly includes criteria they may not be aware of.  

This chapter describes the development of our KB, which combines a variety of sources using a graph database of Resource Description Framework (RDF) \cite{manola2004rdf} triples. Section 5.2 describes our motivation for creating this resources, while Section 5.3 describes the data sources used and methods for KB population. Section 5.4 summarizes the work described in this chapter.

\section{Motivation}

While non-specific eligibility criteria can be categorized in a variety of forms, we noticed a number of frequently used patterns during the development of the LCT and LLF corpora. These categories of non-specific criteria formed the basis of the reasoning capabilities we aimed to enabled:

\begin{enumerate}
    \item \textbf{Treatments for Conditions}, such as \textit{"treated for myocardial infarction"}. Determining whether a patient was treated for this requires first determining what possible treatment options exist for said condition.
    \item \textbf{Contraindications to Treatments}, for example \textit{"Contraindicated for MRI"} or \textit{"With known contraindications to ACE inhibitors"}. Contraindicated concepts must therefore be searched for procedures, surgical treatments, and drugs (including possible drug-drug interactions).
    \item \textbf{Observations indicating a Risk}, such as \textit{"At risk for suicide"} or \textit{"At risk for heart attack"}. Possible observations indicating risk thus include those for self-harm (such as depression) as well as underlying disease.
    \item \textbf{Signs and Symptoms of a Condition}. These may include criteria such as \textit{"Symptoms of depression"} or \textit{"Showing signs of COVID-19"}.
    \item \textbf{Conditions affecting a Physiological Function}, for example \textit{"Conditions affecting respiration"}.
    \item \textbf{Indicated Treatments for a Condition}, such as \textit{"Indicated for anticoagulation therapy"} or \textit{"Indicated for endoscopical drainage"}. 
\end{enumerate}

Beyond facilitating reasoning on non-specific criteria, KBs also serve a vital role in other useful functions, such as determining relevant ICD-10 or SNOMED codes for a given diagnosis, or traversing a concept heirarchy to find relevant related concepts (e.g., determining a range of possible conditions associated with primary hypertension).

\section{Methods}

\subsection{Data Sources}

Given its widespread use and breadth of vocabulary and terminology coverage, we chose to use the UMLS as the core of our KB. Despite the broad coverage of biomedical concepts it represents, however, the UMLS lacks certain data elements, specifically relations, needed to enable our goals for non-specific concept reasoning. For example, the UMLS contains only limited data related to contraindications and symptoms. We thus evaluated informatics literature to find publicly available datasets and ontologies which may help fill these gaps. Importantly, as within the UMLS a Concept Identifier, or "CUI", forms the underlying global identifier linking the various biomedical source systems, we focused on the integration of sources directly (via CUI mappings) or indirectly (via ICD-10 or other coding systems) linkable to the UMLS. We integrated the following ontologies and data sources:

\begin{enumerate}
    \item \textbf{The Disease Ontology (DO)} \cite{schriml2012disease}. The DO is a comprehensive KB of human diseases. The DO features cross references to ICD-9, ICD-10, SNOMED, and other systems. For the purposes of this project, we leverage the DO's listing of symptoms for diseases with mappings to the Symptom Ontology (discussed next). For example, DOID\_0080642 ("Middle East respiratory syndrome") includes SYMP\_0000242 ("cough with bloody sputum") as a symptom. Symptoms related to COVID-19 were added to the DO at our request \footnote{https://github.com/DiseaseOntology/HumanDiseaseOntology/issues/916}.
    \item \textbf{The Symptom Ontology (SO)} \cite{sayers2010database}. The SO is a large KB of symptoms. Like the DO, it includes external references to other vocabularies, including the UMLS. We leverage the DO and SO jointly by mapping both to UMLS CUIs.
    \item \textbf{The COVID-19 Ontology} \cite{sargsyan2020covid}. The COVID-19 ontology includes a variety of data elements and mappings related to COVID-19, such as transmission vectors, signs and symptoms, diagnostic methods, prevention and control, as well as genetic and molecular processes. For our purposes, we leverage risk factors for COVID-19 (COVID\_0000207), which in turn link to DO identifiers.
    \item \textbf{Potential Drug-Drug Interactions (PDDI)} \cite{ayvaz2015toward}. The PDDI is a large data set of potential drug-drug interactions. The PDDI was developed by merging 14 different sources, including from clinical information sources, NLP corpora and pharmacovigilance sources. We used the PDDI for reasoning upon contraindications to medications.
    \item \textbf{The Disease-Symptom Knowledge Base (DSKB} \cite{wang2008automated}. The DSKB is a listing of diseases and corresponding symptoms derived using the NLP system MedLEE \cite{friedman1994general} on 25,074 discharge summaries from New York-Presbyterian Hospital. A random subset of the NLP-derived information was reviewed by a clinician for an overall recall of 90\% and precision of 92\%. The DSKB contains UMLS CUIs and was thus directly linkable to our KB. 
    \item \textbf{LOINC2HPO} \cite{zhang2019semantic}. LOINC2HPO is a data set of approximately 3,000 laboratory tests with corresponding phenotypes depending on their results (e.g., high, low, normal, positive, negative) linked to the Human Phenotype Ontology (which in turn is included in the UMLS). While not directly related to our reasoning use cases, we incorporated LOINC2HPO in order to find patients who may not have diagnosis codes for a given condition but whom a condition could be inferred via laboratory test results.
\end{enumerate}

We further integrated a number of vocabulary mappings which we found potentially useful and not present within the UMLS. For example, an eligibility criteria may specify "Patients mechanically ventilated", which would be normalized to concept C0199470 ("Mechanical Ventilation") using MetaMapLite (discussed in Chapter \ref{chap:query_generation}). Within the UMLS however, C0199470 is not associated with any ICD-10 PCS codes, while within our enterprise data warehouse, mechanical ventilation events are recorded using ICD-10 PCS codes such as "5A19352", which relate to a different concept, C2695822 ("Respiratory Ventilation, Less than 24 Consecutive Hours"). As these concepts and codes are not linked within the UMLS, our KB would not be able to appropriately generate a database query to find mechanically ventilated patients. Using the following sources, however, enables our KB to fill this gap (among many others):

\begin{enumerate}
    \item \textbf{ICD-9-CM to and from ICD-10-CM and ICD-10-PCS Crosswalk or General Equivalence Mappings} \cite{icd9_icd10_icd10pcs}
    \item \textbf{ICD-9-CM Procedure Codes to SNOMED CT Map} \cite{icd9proc_snomed}
    \item \textbf{SNOMED CT to ICD-10-CM Map} \cite{snomed_icd10}
    \item \textbf{ICD-9-CM Diagnostic Codes to SNOMED CT Map} \cite{icd9dx_snomed}
\end{enumerate}

The integration of these additional mappings enable our KB to derive codes for a wide variety of use cases.

\subsection{Graph Database Population}

A KB is an abstract, rather than technical concept, which may be instantiated as a relational or document database, graph, or other data structure. The practical needs and use cases related to eligibility criteria in this project drew us toward the use of a graph database as an optimal solution. An extensive comparison of graph databases versus relational other databases is outside the scope of this discussion. In brief however, both graph and relational databases are capable of storing data encompassing the same linkages and tuples \cite{priyatna2014formalisation}, though by different means. Generally speaking, graph databases enable a more succinct query syntax (i.e., the same data extract can be accomplished using graph database queries linking tuples than one using a large number of SQL JOIN operations) and further do not necessitate a predefined schema, making them ideal for linking and exploring heterogeneous data sources.

We used GraphDB \cite{graphdb}, a robust commercial graph database platform which is free for research use as our KB. To populate our KB, we modified open-source extraction scripts used for BioPortal \cite{noy2009bioportal} which extract UMLS data representations from a SQL database and output into the RDF-compatible format, Terse RDF Triple Language (Turtle) \cite{ttl}. In the original BioPortal extraction scripts\footnote{https://github.com/ncbo/umls2rdf}, UMLS CUIs are represented as strings, such as "C0150840", rather than Internationalized Resource Identifiers (IRIs), such as

\begin{quote}
\centering
$<http://bioportal.bioontology.org/ontologies/ umls\#C0150840>$.
\end{quote}

\noindent IRIs serve as critical structures in RDF for linking data sets together. Storing CUIs as strings results in duplication of data, performance degradation (graph databases optimize retrieval speed by caching IRI-based tuple linkages), and more complicated query syntax which runs somewhat contrary to RDF specifications \cite{manola2004rdf}. We therefore modified\footnote{https://github.com/ndobb/umls2rdf} the BioPortal scripts to treat CUIs as IRIs. We similarly converted data sources not stored in an RDF-related format (such as CSV, HTML, or SQL) to Turtle files by Python script. All Turtle files were subsequently loaded into GraphDB. \\

\subsection{SPARQL Query Development}

After data were loaded in the KB, we developed SPARQL queries for each reasoning and hierarchy traversal use case. SPARQL is a graph query language developed by the W3C and features a syntax relatively similar to SQL \cite{sparql}. For SPARQL queries related to reasoning use cases, development generally involved exploration of UMLS relations across various vocabularies, in addition to non-UMLS sources in our KB. In cases where more than one relation type was found, we traversed tuples from multiple vocabularies using $UNION$ or $IN (<relation1, relation2, ...>)$ syntax.

Below is an example of a SPARQL query for extracting concepts related to a sign or symptom. The script accepts a $@cui$ parameter and traverses the KB, outputting sign and symptom-related CUIs and metadata from the DSKB, DO, and Omaha System ontologies (the latter contained within the UMLS but not updated since 2007).  \\

\def\baselinestretch{1.0}    
\begin{lstlisting}
# get_signs_and_symptoms_by_condition_cui.sparql
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX skos: <http://www.w3.org/2004/02/skos/core#>
PREFIX umls: <http://bioportal.bioontology.org/ontologies/umls#>
PREFIX oms:  <http://purl.bioontology.org/ontology/OMS#>
PREFIX dis:  <http://purl.obolibrary.org/obo/DOID_>
PREFIX dskb: <http://purl.bioontology.org/ontology/DSKB#>

SELECT ?cui ?label ?sab ?code ?code_label ?tui
WHERE 
{
    ?subj_iri skos:notation  ?subj_cui   .
    ?subj_iri skos:prefLabel ?subj_label .
    ?subj_iri ?rel1          ?obj1_iri   .
    ?obj1_iri skos:notation  ?cui        .
    ?obj1_iri skos:prefLabel ?label      .
    ?obj1_iri umls:code      ?code_iri   .
    OPTIONAL
    {
        ?code_iri skos:notation  ?code       .
        ?code_iri skos:prefLabel ?code_label .
        ?code_iri rdfs:domain    ?ont_iri    .
        ?ont_iri  rdfs:label     ?sab        .
        ?obj1_iri umls:sty       ?sty_iri    .
        ?sty_iri  skos:notation  ?tui        .
    }
    FILTER (?subj_cui = @cui) 
    FILTER (?rel1 IN (
                dskb:hasSymptom,
                dis:hasSymptom
                oms:has_sign_or_symptom
            ))
}
\end{lstlisting}
\def\baselinestretch{1.5}    

\section{Limitations}

Our KB has a number limitations. First, the KB does not have a means of representing severity, probability, significance, or other nuanced relationships between a subject concept and reasoned concepts. For example, the PDDI data source lists certain drug-drug interactions as low in significance or only possible, and thus including those as contraindications may be unhelpful in certain cases. Chapter \ref{chap:web_appplication} demonstrates that users have the ability to edit reasoned concepts in our web application, which we believe makes this an acceptable tradeoff. Second, our KB is capable of providing only UMLS concepts as output, which in certain cases this is not ideal. For example, our KB may return a concept such as "Old age" (C1999167) or "Low Platelet Count" (C5201036), which would be translated downstream into SNOMED or other codes for a structured query. We suspect that in most cases though, determining that a patient is over a certain age or has low platelet counts would be more accurately performed by querying structured demographic or laboratory result data directly (e.g., "WHERE patient\_age >= 65"). In a related fashion, more complex reasoning tasks, such as for patients "Indicated for bariatric surgery", require complex Boolean logic to be represented appropriately:

\begin{quote}
    \begin{enumerate}
        \item \textit{Body mass index (BMI) is 40 or higher, called extreme obesity, OR}
        \item \textit{BMI is 35 to 39.9, called obesity, and have a serious weight-related health problem, such as type 2 diabetes, high blood pressure or severe sleep apnea.}
        \item \textit{In some cases, BMI is 30 to 34 and have serious weight-related health problems.}\footnote{Adapted from \url{https://www.mayoclinic.org/tests-procedures/bariatric-surgery/about/pac-20394258}}
    \end{enumerate}
\end{quote}

Our KB is currently unable to represent reasoning logic like this, as it can respond with only a list of UMLS concepts. In future work, we may examine adaptation of our KB to respond with logical forms (Chapter \ref{chap:llf_corpus}), which would be capable of representing these more complex cases.

\section{Summary}

This chapter describes the motivation and development of our KB, instantiated as a graph database which incorporates the UMLS and numerous other linked sources. Our KB forms the underlying foundation which enables reasoning on non-specific criteria (described in Chapter \ref{chap:query_generation}).

\end{document}